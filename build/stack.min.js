/*! stack 2013-10-04 */
!function(a,b){"use strict";function c(){throw new TypeError("Argument must be a function or Stack.")}function d(){return(0|65536*(1+Math.random())).toString(16).substring(1)}function e(){return(d()+d()+"-"+d()+d()+"-"+d()+"-"+d()+d()+d()).toLowerCase()}function f(a,b){return Array.prototype.push.apply(a,b),a}function g(a,b){return function(d,e){return d?"function"==typeof d?a.apply(this,arguments):d.isStack?b.apply(this,arguments):c():a.apply(this,[i,e])}}function h(a){return Array.isArray(a)?a:a?[a]:[]}function i(a){return arguments.length>1?arguments:a}function j(a,b){return this.fn.call(b||this,a)}function k(a,b){return this.fn.apply(b||this,a)}function l(a){return function(){for(var b=a.apply(this,arguments);"function"==typeof b;)b=b();return b}}function m(a,b){return l(function c(){var d=this,e=arguments;return function(){return a.apply(d,e)&&d||d.next&&c.apply(d.next,b?b.apply(this,e):e)}})}function n(a,b,c){this.fn=a,this.receiver=b,this.args=c||[]}function o(a,b,c){return l(function d(){var g=this,h=arguments;return g.debug&&(g.id=g.id||e(),g.debug(g,h,a,b,c)),function(){var e=a.apply(g,h);return c&&c.call(g,e)?e:e&&e.isStack?d.apply(e,h):e===p.pause?new n(function(){return d.apply(this,arguments)},g.next,b?b.apply(g,h):h):e&&e.then&&"pending"===e.inspect().state?e.then(function(){return g.next?d.apply(g.next,b?b.apply(g,h):h)():h}):g.next?d.apply(g.next,b?b.apply(g,f([e],h)):h):e}})}function p(a,c){var d;return Array.isArray(a)?(d=a.slice(0),d.reduce(function(a,b){return a.push(b)},p.create(d.shift()))):a&&a.isStack?c&&c.isStack?new p(a.fn,c):a:this instanceof p?(this.fn=a||i,this.next=c||b,void 0):new p(a,c)}n.prototype.isContinuation=!0,n.prototype.run=function(a,b){return l(this.fn).apply(b||this.receiver,a||this.args)},n.prototype.value=function(){return this.args&&2===this.args.length&&this.args[1]===b?this.args[0]:this.args},p.create=g(p,i),p.prototype.clone=function(a,b){return new p(a||this.fn,b||this.next)},p.pause={},p.alias=function(a,b){return this.prototype[b]=this.prototype[a],this},p.prototype.isStack=!0,p.prototype.pause=function(){return p.pause},p.prototype.push=g(function(a){return new p(a,this)},function(a){return a.precedent().next=this,a}),p.prototype.pop=function(){return this.next=b,this},p.prototype.shift=function(){var a=this.superPrecedent(),c=a.next;return a.next=b,c},p.prototype.unshift=function(a){return this.precedent().insert(a)},p.prototype.drop=function(){var a=this.next;return this.next=b,a},p.prototype.remove=function(){return this.next&&(this.next=this.next.next),this},p.prototype.insert=g(function(a){return this.next=new p(a,this.next)},function(a){var b=this.next;return this.next=a,a.next=b,this}),p.prototype.before=g(function(a,c){return(this.using(a||b)||this).insert(c)},function(a,c){return(this.precedent(a||b)||this).insert(c)}),p.prototype.index=m(function(a){return 0===a},function(a){return[--a]}),p.prototype.find=m(function(a){return this.id===a}),p.prototype.uses=function(a){return this.fn===a},p.prototype.using=m(p.prototype.uses),p.prototype.composedWith=m(function(a){return this.next&&this.next.fn===a}),p.prototype.precedes=function(a){return this.next===a},p.prototype.precedent=m(p.prototype.precedes),p.prototype.superPrecedent=m(function(a){return this.next&&this.next.next===a}),p.prototype.recur=m,p.prototype.iterate=o,p.prototype.assign=o(j),p.prototype.spread=o(k),p.prototype.pipe=o(j,function(a,b,c){return[a,c]}),p.prototype.funnel=o(k,function(a,b,c){return[h(a),c]}),p.prototype.some=o(j,null,function(a){return a===!0}),p.prototype.every=o(j,null,function(a){return a===!1}),p.alias("push","from").alias("insert","to").alias("insert","compose").alias("precedent","tail"),a.Stack=p}(this);